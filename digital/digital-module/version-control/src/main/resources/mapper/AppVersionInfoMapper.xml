<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.meide.versioncontrol.mapper.AppVersionInfoMapper">

    <resultMap id="BaseResultMap" type="com.meide.versioncontrol.domain.entity.AppVersionInfoEntity">
        <result property="versionId" column="version_id" jdbcType="INTEGER"/>
        <result property="updateStatus" column="update_status" jdbcType="INTEGER"/>
        <result property="versionCode" column="version_code" jdbcType="INTEGER"/>
        <result property="versionName" column="version_name" jdbcType="VARCHAR"/>
        <result property="modifyContent" column="modify_content" jdbcType="VARCHAR"/>
        <result property="downloadUrl" column="download_url" jdbcType="VARCHAR"/>
        <result property="apkSize" column="apk_size" jdbcType="INTEGER"/>
        <result property="apkSign" column="apk_sign" jdbcType="VARCHAR"/>
        <result property="appKey" column="app_key" jdbcType="VARCHAR"/>
        <result property="createBy" column="create_by" jdbcType="VARCHAR"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="updateBy" column="update_by" jdbcType="VARCHAR"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="resultSql">
        select version_id,update_status,version_code,version_name,modify_content,download_url,apk_size,apk_sign,
        app_key,create_by,create_time,update_by,update_time from app_version_info
    </sql>

    <insert id="insertVersion">
        insert into app_version_info
        (update_status,version_code,version_name,modify_content,download_url,apk_size,apk_sign,
        app_key,create_by,create_time)
        values
        (#{entity.updateStatus},#{entity.versionCode},#{entity.versionName},#{entity.modifyContent},#{entity.downloadUrl},#{entity.apkSize},#{entity.apkSign},
        #{entity.appKey},#{entity.createBy},#{entity.createTime})
    </insert>
    <update id="updateVersion">
        update app_version_info
        <set>
            <if test="entity.updateStatus != null">update_status=#{entity.updateStatus},</if>
            <if test="entity.versionCode != null">version_code=#{entity.versionCode},</if>
            <if test="entity.versionName != null">version_name=#{entity.versionName},</if>
            <if test="entity.modifyContent != null">modify_content=#{entity.modifyContent},</if>
            <if test="entity.downloadUrl != null">download_url=#{entity.downloadUrl},</if>
            <if test="entity.apkSize != null">apk_size=#{entity.apkSize},</if>
            <if test="entity.apkSign != null">apk_sign=#{entity.apkSign},</if>
            <if test="entity.appKey != null">app_key=#{entity.appKey},</if>
            <if test="entity.updateBy != null">update_by=#{entity.updateBy},</if>
            <if test="entity.updateTime != null">update_time=#{entity.updateTime}</if>
        </set>
        where version_id=#{entity.versionId}
    </update>
    <delete id="deleteVersion">
        delete from app_version_info where version_id in
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <select id="selectVersionList" resultType="com.meide.versioncontrol.domain.entity.AppVersionInfoEntity">
        <include refid="resultSql"/>
        <where>
            <if test="entity.versionCode!=null and entity.versionCode!=''">
                and version_code = #{entity.versionCode}
            </if>
            <if test="entity.appKey!=null and entity.appKey!=''">
                and app_key like concat('%',#{entity.appKey},'%')
            </if>
            <if test="entity.createBy!=null and entity.createBy!=''">
                and create_by = #{entity.createBy}
            </if>
        </where>
        order by app_key asc,version_code desc
    </select>
    <select id="selectVersionById" resultType="com.meide.versioncontrol.domain.entity.AppVersionInfoEntity">
        <include refid="resultSql"/>
        where version_id = #{versionId}
    </select>
</mapper>